{"remainingRequest":"/Users/t.j/OPCR/Projet7/Frontend/node_modules/babel-loader/lib/index.js!/Users/t.j/OPCR/Projet7/Frontend/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/t.j/OPCR/Projet7/Frontend/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!/Users/t.j/OPCR/Projet7/Frontend/src/views/Stream.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/t.j/OPCR/Projet7/Frontend/src/views/Stream.vue","mtime":1610031143000},{"path":"/Users/t.j/OPCR/Projet7/Frontend/node_modules/cache-loader/dist/cjs.js","mtime":1635943526508},{"path":"/Users/t.j/OPCR/Projet7/Frontend/node_modules/babel-loader/lib/index.js","mtime":1635943529871},{"path":"/Users/t.j/OPCR/Projet7/Frontend/node_modules/cache-loader/dist/cjs.js","mtime":1635943526508},{"path":"/Users/t.j/OPCR/Projet7/Frontend/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js","mtime":1635943530684}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKaW1wb3J0IF90eXBlb2YgZnJvbSAiL1VzZXJzL3Quai9PUENSL1Byb2pldDcvRnJvbnRlbmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3R5cGVvZiI7CmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCByb3V0ZXIgZnJvbSAiLi4vcm91dGVyIjsKaW1wb3J0ICIuLi9tYWluLmNzcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiU3RyZWFtIiwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaXNBZG1pbjogZmFsc2UsCiAgICAgIG1lc3NhZ2VzOiBbXSwKICAgICAgaWQ6ICIiLAogICAgICBuYW1lOiAiIiwKICAgICAgY3JlYXRpb246ICIiCiAgICB9OwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgdmFyIGlkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJJZCcpOwogICAgYXhpb3MuZ2V0KCJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL21lc3NhZ2VzIiwgewogICAgICBoZWFkZXJzOiB7CiAgICAgICAgIkF1dGhvcml6YXRpb24iOiAiQmVhcmVyICIgKyBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgidG9rZW4iKQogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgaWYgKHJlcykgewogICAgICAgIHZhciByZXAgPSByZXMuZGF0YS5saXN0OwogICAgICAgIF90aGlzLm1lc3NhZ2VzID0gcmVwOwogICAgICAgIHJlcC5zcGxpY2UoMTApOwogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJNZXNzYWdlSWQiLCByZXBbMF0uaWQpOwogICAgICAgIGNvbnNvbGUubG9nKF90aGlzLm1lc3NhZ2VzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZygiYXVjdW4gbWVzc2FnZSIpOwogICAgICB9CiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgfSk7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBheGlvcy5nZXQoImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvdXNlcnMvIiArIGlkLCB7CiAgICAgIGhlYWRlcnM6IHsKICAgICAgICAiQXV0aG9yaXphdGlvbiI6ICJCZWFyZXIgIiArIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ0b2tlbiIpCiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICBjb25zb2xlLmxvZyhyZXMpOwogICAgICBzZWxmLmlkID0gcmVzLmRhdGEuaWQ7CiAgICAgIHNlbGYubmFtZSA9IHJlcy5kYXRhLnVzZXJOYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcmVzLmRhdGEudXNlck5hbWUuc2xpY2UoMSk7CiAgICAgIHNlbGYuY3JlYXRpb24gPSByZXMuZGF0YS5jcmVhdGVkQXQuc2xpY2UoMCwgMTApLnNwbGl0KCItIikucmV2ZXJzZSgpLmpvaW4oIi4iKTsKICAgICAgc2VsZi5pc0FkbWluID0gcmVzLmRhdGEuaXNBZG1pbjsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICB9KTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGNvbW1lbnRQYWdlOiBmdW5jdGlvbiBjb21tZW50UGFnZShtKSB7CiAgICAgIGNvbnNvbGUubG9nKG0pOwogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnTWVzc2FnZUlkJywgbSk7CiAgICAgIHJvdXRlci5wdXNoKHsKICAgICAgICBwYXRoOiAiL0NvbW1lbnQiCiAgICAgIH0pOwogICAgfSwKICAgIGRlbGV0ZU1lc3NhZ2U6IGZ1bmN0aW9uIGRlbGV0ZU1lc3NhZ2UoYSwgYiwgYykgewogICAgICBjb25zb2xlLmxvZyhfdHlwZW9mKGEpLCBfdHlwZW9mKGIpLCBfdHlwZW9mKGMpKTsKICAgICAgdmFyIGNvbmZpcm1NZXNzYWdlRGVsZXRpb24gPSBjb25maXJtKCJ2b3VsZXotdm91cyB2cmFpbWVudCBzdXBwcmltZXIgY2V0dGUgaW1hZ2UgPywgdG91cyBsZXMgY29tbWVudGFpcmVzIGFzc29jacOpcyBzZXJvbnQgw6lnYWxlbWVudCBzdXBwcmltw6lzLiIpOwoKICAgICAgaWYgKGNvbmZpcm1NZXNzYWdlRGVsZXRpb24gPT0gdHJ1ZSkgewogICAgICAgIGF4aW9zLmRlbGV0ZSgiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9tZXNzYWdlcy8iLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICJBdXRob3JpemF0aW9uIjogIkJlYXJlciAiICsgbG9jYWxTdG9yYWdlLmdldEl0ZW0oInRva2VuIikKICAgICAgICAgIH0sCiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgbWVzc2FnZUlkOiBhLAogICAgICAgICAgICBtZXNzYWdlVWlkOiBiLAogICAgICAgICAgICB1aWQ6IGMKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIHJldHVybiBjb25zb2xlLmxvZyhyZXMpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgICBjb25zb2xlLmxvZygibGlnbmUgMTMzICIgKyBlcnJvcik7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9LAogICAgbG9jYWxDbGVhcjogZnVuY3Rpb24gbG9jYWxDbGVhcigpIHsKICAgICAgbG9jYWxTdG9yYWdlLmNsZWFyKCk7CiAgICAgIHJvdXRlci5wdXNoKHsKICAgICAgICBwYXRoOiAiLyIKICAgICAgfSk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"sources":["/Users/t.j/OPCR/Projet7/Frontend/src/views/Stream.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <main class=\"container\">    \n        <div class=\"col-12\">\n            <div class=\"col-12 \">\n                <h1 v-if= 'this.messages.length !== 0' class=\"col-12 my-2 btn  btn-block btn-info font-weight-bold\" style=\"background-color: #138400; cursor:default\">Dernières Publications</h1>   \n                <h1  v-else class='col-12 my-2 btn  btn-block btn-danger font-weight-bold' style=\"cursor:default\"> Aucune publication pour l'instant, soyez le premier à en créer une ! </h1>\n            </div>\n            <section id=\"filPrincipal\" class=\"row\">\n                 <!-- bloc utilisateur -->\n                <article class=\"col-12 col-md-4\">\n                    <div class=\"card bg-light my-3 class=center-block\" style=\"float:none;\">\n                        <div class=\"card-header\">\n                            <div class=\"row justify-content-around\">\n                                <p class=\"m-1\"> Bonjour {{ name }} ! </p>\n                                <button @click=\"localClear\"> <img src=\"../assets/signout.svg\" alt=\"sign-out\" style=\"width:35px\"/> </button>\n                            </div>\n                        </div>\n                        <div class=\"card-body\">\n                            <div class=\"text-center\">\n                                <p id=\"membre\">Membre depuis le {{ creation }}</p>\n                            </div>\n                            <div id=\"compteButton\" class=\"text-center\">\n                                <router-link v-if=\"isAdmin\" to='/Admin'><button type=\"button\" class=\" btn btn-danger mx-auto rounded p-2 buttonsPanel\">ADMIN. <button class=\" rounded p-1 m-1 \"><img src=\"../assets/trash.svg\" alt=\"trash\" style=\"width:25px\"> ACTIVÉE</button></button></router-link> \n                                <router-link v-else to='/Compte'><button type=\"button\" class=\" btn btn-secondary mx-auto rounded p-2 buttonsPanel\">COMPTE</button></router-link> \n                            </div>\n                        </div>\n                        <div id=\"publicationButton\" class=\" card-body text-center\">\n                            <router-link to='/Create' ><button type=\"button\" class=\"btn btn-dark mx-auto p-2 rounded buttonsPanel\">PUBLIER</button></router-link>\n                        </div>\n                    </div>                  \n                </article>\n                 <!-- bloc avec tous le(s) message(s) -->\n                <sub class=\"col-12 col-md-8\">\n                    <div v-for=\"message in messages\" :key=\"message.id\" class=\"card bg-light my-3\">\n                        <div class=\"card-header bg-light d-flex align-items-center justify-content-between m-0 p-1\">\n                            <span class=\" text-dark text-bold  p-1\" >\n                                Posté par {{ message.userName.charAt(0).toUpperCase() + message.userName.slice(1) }}\n                                le {{ message.createdAt.slice(0,10).split('-').reverse().join('.') + ' à ' + message.createdAt.slice(11,16) }}\n                            </span>\n                            <div class=\"badge bg-dark text-wrap text-white p-2\" style=\"width: 6rem;\">\n                                ref # {{ message.id }}                    \n                            </div>                                                                                       \n                        </div>\n                        <div class=\"btn\" @click=\"commentPage(message.id)\">\n                            <img :src=\"message.messageUrl\" v-if=\"message.messageUrl !== '' \" class=\"border messImage\" alt=\"image postée par un utilisateur\" />\n                        </div>\n                        <div class=\"p-2\"> \n                            <p v-if=\"isAdmin || message.UserId == id\" class=\"ml-2\">   {{ message.message }} </p> \n                        </div>\n                        <div class=\"row card-footer justify-content-around\">\n                            <button @click=\"commentPage(message.id)\" class=\"border-0\"> <img src=\"../assets/comment_black.svg\" alt=\"comment_black\" style=\"width:25px\"> </button>\n                            <div v-if=\"isAdmin || message.UserId == id\">\n                                <button @click=\"deleteMessage(message.id, message.UserId, id)\" class=\"border-0\"> <img  src=\"../assets/trash.svg\" alt=\"trash\" style=\"width:25px\"> </button>\n                            </div>\n                        </div>                             \n                    </div>                        \n                </sub>\n            </section>\n        </div>\n    </main>\n</template>\n\n<script>\n\nimport axios from \"axios\";\nimport router from \"../router\";\nimport \"../main.css\";\n\nexport default {\n    name: \"Stream\",\n    data() {\n        return {\n            isAdmin: false,\n            messages: [],\n            id: \"\",                 \n            name: \"\",               \n            creation: \"\"           \n        }\n    },\n    created: function() {        \n        let id = localStorage.getItem('userId')\n        axios.get(\"http://localhost:3000/api/messages\",  { headers: {\"Authorization\": \"Bearer \" + localStorage.getItem(\"token\")} })\n        .then((res) => {\n            if (res) {\n                const rep = res.data.list;\n                this.messages = rep; \n                rep.splice(10,);\n                localStorage.setItem(\"MessageId\", rep[0].id);\n                console.log(this.messages)\n            } else {\n                console.log(\"aucun message\")\n            }\n        })\n        .catch((error)=>{\n            console.log(error)\n        })   \n        let self = this;\n        axios.get(\"http://localhost:3000/api/users/\" + id, { headers: {\"Authorization\": \"Bearer \" + localStorage.getItem(\"token\")} })\n        .then(res => {  \n            console.log(res)\n            self.id                 = res.data.id;\n            self.name               = res.data.userName.charAt(0).toUpperCase() + res.data.userName.slice(1);\n            self.creation           = res.data.createdAt.slice(0,10).split(\"-\").reverse().join(\".\");\n            self.isAdmin            = res.data.isAdmin;\n        })\n        .catch((error)=> { console.log(error) \n        });    \n    },\n    methods: {\n        commentPage(m) {\n            console.log(m);\n            localStorage.setItem('MessageId', m);\n            router.push({ path : \"/Comment\" });\n        },\n        deleteMessage(a, b, c) {\n            console.log(\n                typeof a,\n                typeof b,\n                typeof c\n            )\n            let confirmMessageDeletion = confirm(\"voulez-vous vraiment supprimer cette image ?, tous les commentaires associés seront également supprimés.\");\n            if (confirmMessageDeletion == true) {\n                axios.delete(\"http://localhost:3000/api/messages/\", {\n                    headers: { \n                        \"Authorization\": \"Bearer \" + localStorage.getItem(\"token\") \n                    },\n                    params: {\n                        messageId:  a,\n                        messageUid: b,\n                        uid:        c\n                    }\n                    })\n                .then((res)=> console.log(res))\n                .catch((error) => { \n                    location.reload();\n                    console.log(\"ligne 133 \" + error)})\n            } else {\n                return\n            }\n        },\n        localClear() {\n            localStorage.clear();\n            router.push({ path : \"/\" });\n        }\n    }\n}\n</script>"],"sourceRoot":""}]}